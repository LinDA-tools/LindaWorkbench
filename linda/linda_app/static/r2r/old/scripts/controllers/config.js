// Generated by CoffeeScript 1.8.0
(function() {
  'use strict';
  var ModalInstanceCtrl;

  ModalInstanceCtrl = function($scope, $modalInstance, item, title) {
    $scope.title = title;
    $scope.selected = item;
    $scope.save = function() {
      return $modalInstance.close($scope.selected);
    };
    return $scope.cancel = function() {
      return $modalInstance.dismiss('cancel');
    };
  };

  angular.module('app').controller('ConfigCtrl', function($scope, $modal, R2rs, Config) {
    $scope.config = Config;
    $scope.datasource = $scope.config.datasources[0];
    $scope.$watch('config.datasource', function(value) {
      var i, spec;
      spec = ((function() {
        var _i, _len, _ref, _results;
        _ref = $scope.config.datasources;
        _results = [];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          i = _ref[_i];
          if (i.name === value) {
            _results.push(i);
          }
        }
        return _results;
      })())[0];
      if (spec) {
        return R2rs.registerDatabase(spec);
      }
    });
    $scope.newDatasource = function() {
      var modalInstance;
      modalInstance = $modal.open({
        templateUrl: '/static/r2r/partials/config_datasource.html',
        controller: ModalInstanceCtrl,
        resolve: {
          item: function() {
            return {
              'name': '',
              'subprotocol': '',
              'subname': '',
              'username': '',
              'password': ''
            };
          },
          title: function() {
            return 'Create new datasource ...';
          }
        }
      });
      return modalInstance.result.then(function(item) {
        $scope.config.datasources.push(item);
        return $scope.config.datasource = item;
      });
    };
    return $scope.editDatasource = function() {
      var index, modalInstance;
      index = $scope.config.datasources.indexOf($scope.config.datasource);
      modalInstance = $modal.open({
        templateUrl: '/static/r2r/partials/config_datasource.html',
        controller: ModalInstanceCtrl,
        resolve: {
          item: function() {
            return $scope.config.datasources[index];
          },
          title: function() {
            return 'Configure datasource ...';
          }
        }
      });
      return modalInstance.result.then(function(item) {
        $scope.config.datasources[index] = item;
        return $scope.config.datasource = item;
      });
    };
  });

}).call(this);
