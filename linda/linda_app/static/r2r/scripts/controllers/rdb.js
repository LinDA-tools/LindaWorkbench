// Generated by CoffeeScript 1.8.0
(function() {
  'use strict';
  angular.module('app').controller('RdbCtrl', function($scope, $http, Config, Rdb, R2rs) {
    $scope.config = Config;
    $scope.rdb = Rdb;
    $scope.tables = [];
    $scope.data = [];
    $scope.columnsMap = [];
    $scope.$watch('config.datasource', function(value) {
      if (value != null) {
        return R2rs.getTables().then(function(promise) {
          return $scope.tables = promise;
        });
      }
    });
    $scope.$watch('rdb.table', function(value) {
      if (value != null) {
        return R2rs.getColumnsMap(value).then(function(promise) {
          return $scope.columnsMap = promise;
        });
      }
    });
    return $scope.$watch('columnsMap', function(value) {
      if ((Rdb.table != null) && (value != null)) {
        return R2rs.getTableData(Rdb.table, value).then(function(promise) {
          Rdb.columns = promise.columns;
          return $scope.data = promise.data;
        });
      }
    });
  });

}).call(this);
